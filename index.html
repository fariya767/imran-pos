<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ржЗржорж░рж╛ржи ржЗрж▓рзЗржХржЯрзНрж░ржирж┐ржХрзНрж╕ POS</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{background:#f4f6f9;}
.header{background:#0d6efd;color:white;padding:15px;border-radius:10px;}
.card-box{background:white;padding:15px;border-radius:10px;margin-top:15px;}
.hidden{display:none;}
.summary{font-weight:bold;font-size:18px;}
@media print{
body *{visibility:hidden;}
#printArea, #printArea *{visibility:visible;}
#printArea{position:absolute;left:0;top:0;width:100%;}
}
</style>
</head>

<body>
<div class="container py-4">

<!-- LOGIN -->
<div id="loginSection" class="card-box">
<h4 class="text-center">ЁЯФР рж▓ржЧржЗржи</h4>
<input type="password" id="passwordInput" class="form-control mt-3" placeholder="ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб">
<button class="btn btn-primary w-100 mt-3" onclick="login()">рж▓ржЧржЗржи</button>
<p id="loginMsg" class="text-center mt-2 text-danger"></p>
</div>

<!-- MAIN APP -->
<div id="app" class="hidden">

<div class="header text-center mb-3">
<h4>ржЗржорж░рж╛ржи ржЗрж▓рзЗржХржЯрзНрж░ржирж┐ржХрзНрж╕ ржПржирзНржб ржорзЛржмрж╛ржЗрж▓ рж╕рж╛рж░рзНржнрж┐рж╕рж┐ржВ рж╕рзЗржирзНржЯрж╛рж░</h4>
<p>рж░рж╣рж┐ржо рж╕рж░ржжрж╛рж░ ржорж╛рж░рзНржХрзЗржЯ, ржЧржжржЦрж╛рж▓рзА ржмрж╛ржЬрж╛рж░, ржЭрж┐ржХрж░ржЧрж╛ржЫрж╛, ржпрж╢рзЛрж░</p>
<p>ржорзЛржмрж╛ржЗрж▓: рзжрззрзпрзлрзирзйрзирзлрзпрзжрзй</p>
<button class="btn btn-light btn-sm" onclick="logout()">рж▓ржЧржЖржЙржЯ</button>
</div>

<!-- ADD PRODUCT -->
<div class="card-box">
<h5>ЁЯУж ржкржгрзНржп ржпрзЛржЧ ржХрж░рзБржи</h5>
<input id="pName" class="form-control mt-2" placeholder="ржкржгрзНржпрзЗрж░ ржирж╛ржо">
<input id="pBuy" type="number" class="form-control mt-2" placeholder="ржХрзНрж░рзЯржорзВрж▓рзНржп">
<input id="pSell" type="number" class="form-control mt-2" placeholder="ржмрж┐ржХрзНрж░рзЯржорзВрж▓рзНржп">
<input id="pStock" type="number" class="form-control mt-2" placeholder="рж╕рзНржЯржХ">
<button class="btn btn-success w-100 mt-2" onclick="addProduct()">ржпрзЛржЧ ржХрж░рзБржи</button>
</div>

<!-- SALE -->
<div class="card-box">
<h5>ЁЯЫТ ржмрж┐ржХрзНрж░рзЯ ржХрж░рзБржи</h5>
<select id="saleProduct" class="form-control mt-2"></select>
<input id="saleQty" type="number" class="form-control mt-2" placeholder="ржкрж░рж┐ржорж╛ржг">
<button class="btn btn-primary w-100 mt-2" onclick="makeSale()">ржмрж┐ржХрзНрж░рзЯ ржХрж░рзБржи</button>
</div>

<!-- SUMMARY -->
<div class="card-box">
<div class="summary">ржорзЛржЯ ржмрж┐ржХрзНрж░рзЯ: <span id="totalSale">0</span> рз│</div>
<div class="summary">ржорзЛржЯ рж▓рж╛ржн: <span id="totalProfit">0</span> рз│</div>
</div>

<!-- SALES TABLE -->
<div class="card-box">
<h5>ЁЯУД ржмрж┐ржХрзНрж░рзЯрзЗрж░ рждрж╛рж▓рж┐ржХрж╛</h5>
<table class="table table-bordered">
<thead><tr><th>ржирж╛ржо</th><th>ржкрж░рж┐ржорж╛ржг</th><th>ржорзЛржЯ</th><th>рж▓рж╛ржн</th><th>ржЕрзНржпрж╛ржХрж╢ржи</th></tr></thead>
<tbody id="saleTable"></tbody>
</table>
</div>

<!-- REPORT -->
<div class="card-box">
<h5>ЁЯУК рж░рж┐ржкрзЛрж░рзНржЯ</h5>
<canvas id="chart"></canvas>
</div>

<button class="btn btn-danger w-100 mt-3" onclick="resetData()">рж╕ржм ржбрж╛ржЯрж╛ ржбрж┐рж▓рж┐ржЯ</button>

</div>
</div>

<!-- PRINT AREA -->
<div id="printArea" class="p-4 hidden"></div>

<script>

let products=JSON.parse(localStorage.getItem("products"))||[];
let sales=JSON.parse(localStorage.getItem("sales"))||[];

if(localStorage.getItem("loggedIn")==="true"){
loginSection.classList.add("hidden");
app.classList.remove("hidden");
init();
}

function login(){
let pass=passwordInput.value;
let saved=localStorage.getItem("posPass");
if(!saved){
localStorage.setItem("posPass",pass);
alert("ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рж╕рзЗржЯ рж╣рзЯрзЗржЫрзЗред ржЖржмрж╛рж░ рж▓ржЧржЗржи ржХрж░рзБржи");
return;
}
if(pass===saved){
localStorage.setItem("loggedIn","true");
loginSection.classList.add("hidden");
app.classList.remove("hidden");
init();
}else{
loginMsg.innerText="ржнрзБрж▓ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб";
}
}

function logout(){
localStorage.setItem("loggedIn","false");
location.reload();
}

function init(){
updateProductList();
updateSummary();
updateTable();
updateChart();
}

function addProduct(){
let p={name:pName.value,buy:+pBuy.value,sell:+pSell.value,stock:+pStock.value};
products.push(p);
localStorage.setItem("products",JSON.stringify(products));
updateProductList();
alert("ржкржгрзНржп ржпрзЛржЧ рж╣рзЯрзЗржЫрзЗ");
}

function updateProductList(){
saleProduct.innerHTML="";
products.forEach((p,i)=>{
saleProduct.innerHTML+=`<option value="${i}">${p.name} (рж╕рзНржЯржХ:${p.stock})</option>`;
});
}

function makeSale(){
let i=saleProduct.value;
let qty=+saleQty.value;
if(products[i].stock<qty){alert("рж╕рзНржЯржХ ржХржо");return;}
let total=qty*products[i].sell;
let profit=qty*(products[i].sell-products[i].buy);
products[i].stock-=qty;
sales.push({name:products[i].name,qty,total,profit,date:new Date().toLocaleDateString()});
localStorage.setItem("sales",JSON.stringify(sales));
localStorage.setItem("products",JSON.stringify(products));
updateProductList();
updateSummary();
updateTable();
updateChart();
printInvoice(products[i].name,qty,total);
}

function updateSummary(){
let t=0,p=0;
sales.forEach(s=>{t+=s.total;p+=s.profit});
totalSale.innerText=t;
totalProfit.innerText=p;
}

function updateTable(){
saleTable.innerHTML="";
sales.forEach((s,i)=>{
saleTable.innerHTML+=`<tr>
<td>${s.name}</td>
<td>${s.qty}</td>
<td>${s.total}</td>
<td>${s.profit}</td>
<td><button onclick="deleteSale(${i})" class="btn btn-sm btn-danger">ржбрж┐рж▓рж┐ржЯ</button></td>
</tr>`;
});
}

function deleteSale(i){
sales.splice(i,1);
localStorage.setItem("sales",JSON.stringify(sales));
updateSummary();
updateTable();
updateChart();
}

function updateChart(){
let dates={};
sales.forEach(s=>{
if(!dates[s.date])dates[s.date]=0;
dates[s.date]+=s.total;
});
new Chart(document.getElementById("chart"),{
type:"bar",
data:{labels:Object.keys(dates),
datasets:[{label:"Daily Sales",data:Object.values(dates)}]}
});
}

function printInvoice(name,qty,total){
printArea.classList.remove("hidden");
printArea.innerHTML=`
<h3>ржЗржорж░рж╛ржи ржЗрж▓рзЗржХржЯрзНрж░ржирж┐ржХрзНрж╕ ржПржирзНржб ржорзЛржмрж╛ржЗрж▓ рж╕рж╛рж░рзНржнрж┐рж╕рж┐ржВ рж╕рзЗржирзНржЯрж╛рж░</h3>
<p>рж░рж╣рж┐ржо рж╕рж░ржжрж╛рж░ ржорж╛рж░рзНржХрзЗржЯ, ржЧржжржЦрж╛рж▓рзА ржмрж╛ржЬрж╛рж░, ржЭрж┐ржХрж░ржЧрж╛ржЫрж╛, ржпрж╢рзЛрж░</p>
<p>ржорзЛржмрж╛ржЗрж▓: рзжрззрзпрзлрзирзйрзирзлрзпрзжрзй</p>
<hr>
<p>рждрж╛рж░рж┐ржЦ: ${new Date().toLocaleString()}</p>
<p>ржкржгрзНржп: ${name}</p>
<p>ржкрж░рж┐ржорж╛ржг: ${qty}</p>
<h4>ржорзЛржЯ: ${total} рз│</h4>
<hr>
<p>ржзржирзНржпржмрж╛ржж</p>
`;
window.print();
printArea.classList.add("hidden");
}

function resetData(){
if(confirm("рж╕ржм ржбрж╛ржЯрж╛ ржбрж┐рж▓рж┐ржЯ ржХрж░ржмрзЗржи?")){
localStorage.clear();
location.reload();
}
}

</script>
</body>
</html>
