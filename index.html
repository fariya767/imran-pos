<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡¶á‡¶Æ‡¶∞‡¶æ‡¶® ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶®‡¶ø‡¶ï‡ßç‡¶∏ POS</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body { background:#f4f6f9; }
.header { background:#0d6efd; color:white; padding:15px; border-radius:10px; }
.card-box { background:white; padding:15px; border-radius:10px; margin-top:15px; }
.hidden { display:none; }
@media print {
    body * { visibility: hidden; }
    #invoiceSection, #invoiceSection * { visibility: visible; }
    #invoiceSection { position:absolute; left:0; top:0; width:100%; }
}
</style>
</head>

<body>
<div class="container py-4">

<!-- Login -->
<div id="loginSection" class="card-box shadow-sm">
<h4 class="text-center">üîê POS ‡¶≤‡¶ó‡¶á‡¶®</h4>
<input type="password" id="passwordInput" class="form-control mt-3" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°">
<button class="btn btn-primary w-100 mt-3" onclick="login()">‡¶≤‡¶ó‡¶á‡¶®</button>
<p class="text-center mt-3" id="loginMessage"></p>
</div>

<!-- Main App -->
<div id="mainApp" class="hidden">

<div class="header text-center mb-3">
<h4>‡¶á‡¶Æ‡¶∞‡¶æ‡¶® ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶®‡¶ø‡¶ï‡ßç‡¶∏ ‡¶è‡¶®‡ßç‡¶° ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏‡¶ø‡¶Ç ‡¶∏‡ßá‡¶®‡ßç‡¶ü‡¶æ‡¶∞</h4>
<p>‡¶∞‡¶π‡¶ø‡¶Æ ‡¶∏‡¶∞‡¶¶‡¶æ‡¶∞ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶ü, ‡¶ó‡¶¶‡¶ñ‡¶æ‡¶≤‡ßÄ ‡¶¨‡¶æ‡¶ú‡¶æ‡¶∞, ‡¶ù‡¶ø‡¶ï‡¶∞‡¶ó‡¶æ‡¶õ‡¶æ, ‡¶Ø‡¶∂‡ßã‡¶∞<br>
‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤: ‡ß¶‡ßß‡ßØ‡ß´‡ß®‡ß©‡ß®‡ß´‡ßØ‡ß¶‡ß©</p>
<button class="btn btn-light btn-sm float-end" onclick="logout()">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
</div>

<!-- Add Product -->
<div class="card-box">
<h5>‚ûï ‡¶™‡¶£‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h5>
<input id="pName" class="form-control mt-2" placeholder="‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ">
<input id="pPrice" type="number" class="form-control mt-2" placeholder="‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø">
<input id="pCost" type="number" class="form-control mt-2" placeholder="‡¶ï‡ßç‡¶∞‡ßü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø">
<input id="pStock" type="number" class="form-control mt-2" placeholder="‡¶∏‡ßç‡¶ü‡¶ï">
<button class="btn btn-success mt-2" onclick="addProduct()">Add Product</button>
</div>

<!-- Sales Section -->
<div class="card-box">
<h5>üõí ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü</h5>

<select id="productSelect" class="form-control mt-2"></select>
<input id="qty" type="number" class="form-control mt-2" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£">
<button class="btn btn-primary mt-2" onclick="addToCart()">Add To Cart</button>

<table class="table mt-3">
<thead>
<tr>
<th>‡¶™‡¶£‡ßç‡¶Ø</th>
<th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th>
<th>‡¶¶‡¶æ‡¶Æ</th>
<th>‡¶Æ‡ßã‡¶ü</th>
<th></th>
</tr>
</thead>
<tbody id="cartTable"></tbody>
</table>

<div>
‡¶Æ‡ßã‡¶ü: <span id="subtotal">0</span> ‡ß≥ <br>
Paid: <input type="number" id="paid" oninput="calculateDue()"><br>
Due: <span id="due">0</span> ‡ß≥
</div>

<button class="btn btn-success mt-2" onclick="finalizeSale()">Final Sale</button>
<button class="btn btn-secondary mt-2" onclick="printInvoice()">Print</button>

</div>

<!-- Report -->
<div class="card-box">
<h5>üìä ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</h5>
<canvas id="salesChart"></canvas>
</div>

<!-- Invoice Print Section -->
<div id="invoiceSection" class="hidden"></div>

</div>
</div>

<script>
let products = JSON.parse(localStorage.getItem("products")) || [];
let sales = JSON.parse(localStorage.getItem("sales")) || [];
let cart = [];
let invoiceCounter = localStorage.getItem("invoiceCounter") || 1;

function login(){
let input=passwordInput.value;
let saved=localStorage.getItem("posPassword");
if(!saved){
localStorage.setItem("posPassword",input);
loginMessage.innerText="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá";
return;
}
if(input===saved){
loginSection.classList.add("hidden");
mainApp.classList.remove("hidden");
loadProducts();
updateChart();
}else{
loginMessage.innerText="‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°";
}
}

function logout(){
mainApp.classList.add("hidden");
loginSection.classList.remove("hidden");
}

function addProduct(){
let name=pName.value;
let price=parseFloat(pPrice.value);
let cost=parseFloat(pCost.value);
let stock=parseInt(pStock.value);
if(!name||price<=0||cost<0||stock<0){alert("‡¶∏‡¶†‡¶ø‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®");return;}
products.push({name,price,cost,stock});
localStorage.setItem("products",JSON.stringify(products));
loadProducts();
alert("‡¶™‡¶£‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá");
}

function loadProducts(){
let select=document.getElementById("productSelect");
select.innerHTML="";
products.forEach(p=>{
select.innerHTML+=`<option value="${p.name}">${p.name} (‡¶∏‡ßç‡¶ü‡¶ï: ${p.stock})</option>`;
});
}

function addToCart(){
let name=productSelect.value;
let qty=parseInt(document.getElementById("qty").value);
if(!name||qty<=0){alert("‡¶∏‡¶†‡¶ø‡¶ï ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶¶‡¶ø‡¶®");return;}
let product=products.find(p=>p.name===name);
if(product.stock<qty){alert("‡¶∏‡ßç‡¶ü‡¶ï ‡¶ï‡¶Æ");return;}
let existing=cart.find(c=>c.name===name);
if(existing){existing.qty+=qty;}
else{cart.push({name,price:product.price,cost:product.cost,qty});}
updateCart();
}

function updateCart(){
let table=document.getElementById("cartTable");
table.innerHTML="";
let total=0;
cart.forEach((item,i)=>{
let rowTotal=item.price*item.qty;
total+=rowTotal;
table.innerHTML+=`<tr>
<td>${item.name}</td>
<td>${item.qty}</td>
<td>${item.price}</td>
<td>${rowTotal}</td>
<td><button onclick="removeItem(${i})" class="btn btn-danger btn-sm">X</button></td>
</tr>`;
});
subtotal.innerText=total;
calculateDue();
}

function removeItem(i){
cart.splice(i,1);
updateCart();
}

function calculateDue(){
let total=parseFloat(subtotal.innerText)||0;
let paid=parseFloat(document.getElementById("paid").value)||0;
if(paid>total){alert("Paid ‡¶¨‡ßá‡¶∂‡¶ø ‡¶¶‡ßá‡ßü‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ");paid=total;paid.value=total;}
due.innerText=total-paid;
}

function finalizeSale(){
if(cart.length==0){alert("‡¶ï‡¶æ‡¶∞‡ßç‡¶ü ‡¶ñ‡¶æ‡¶≤‡¶ø");return;}
let total=parseFloat(subtotal.innerText);
let paid=parseFloat(document.getElementById("paid").value)||0;
let dueAmount=total-paid;
let profit=0;
cart.forEach(item=>{
let product=products.find(p=>p.name===item.name);
product.stock-=item.qty;
profit+=(item.price-item.cost)*item.qty;
});
let invoice="INV-"+invoiceCounter.toString().padStart(4,"0");
sales.push({invoice,items:cart,total,paid,due:dueAmount,profit,date:new Date().toISOString().split("T")[0]});
localStorage.setItem("sales",JSON.stringify(sales));
localStorage.setItem("products",JSON.stringify(products));
invoiceCounter++;
localStorage.setItem("invoiceCounter",invoiceCounter);
generateInvoice(invoice);
cart=[];
updateCart();
loadProducts();
updateChart();
alert("‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®");
}

function generateInvoice(inv){
let sale=sales.find(s=>s.invoice===inv);
let html=`<h4>‡¶á‡¶Æ‡¶∞‡¶æ‡¶® ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶®‡¶ø‡¶ï‡ßç‡¶∏ ‡¶è‡¶®‡ßç‡¶° ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏‡¶ø‡¶Ç ‡¶∏‡ßá‡¶®‡ßç‡¶ü‡¶æ‡¶∞</h4>
<p>‡¶∞‡¶π‡¶ø‡¶Æ ‡¶∏‡¶∞‡¶¶‡¶æ‡¶∞ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶ü, ‡¶ó‡¶¶‡¶ñ‡¶æ‡¶≤‡ßÄ ‡¶¨‡¶æ‡¶ú‡¶æ‡¶∞, ‡¶ù‡¶ø‡¶ï‡¶∞‡¶ó‡¶æ‡¶õ‡¶æ, ‡¶Ø‡¶∂‡ßã‡¶∞<br>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤: ‡ß¶‡ßß‡ßØ‡ß´‡ß®‡ß©‡ß®‡ß´‡ßØ‡ß¶‡ß©</p>
<hr>
Invoice: ${sale.invoice}<br>
Date: ${sale.date}
<table class="table">
<tr><th>‡¶™‡¶£‡ßç‡¶Ø</th><th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th><th>‡¶¶‡¶æ‡¶Æ</th><th>‡¶Æ‡ßã‡¶ü</th></tr>`;
sale.items.forEach(i=>{
html+=`<tr><td>${i.name}</td><td>${i.qty}</td><td>${i.price}</td><td>${i.price*i.qty}</td></tr>`;
});
html+=`</table>
Total: ${sale.total} ‡ß≥<br>
Paid: ${sale.paid} ‡ß≥<br>
Due: ${sale.due} ‡ß≥`;
invoiceSection.innerHTML=html;
}

function printInvoice(){
invoiceSection.classList.remove("hidden");
window.print();
invoiceSection.classList.add("hidden");
}

function updateChart(){
let dates={};
sales.forEach(s=>{
if(!dates[s.date])dates[s.date]=0;
dates[s.date]+=s.total;
});
new Chart(document.getElementById("salesChart"),{
type:"bar",
data:{labels:Object.keys(dates),
datasets:[{label:"Daily Sales ‡ß≥",data:Object.values(dates)}]}
});
}
</script>

</body>
</html>
