<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ржЗржорж░рж╛ржи ржЗрж▓рзЗржХржЯрзНрж░ржирж┐ржХрзНрж╕ POS</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{background:#f4f6f9;}
.header{background:#0d6efd;color:white;padding:15px;border-radius:10px;}
.card-box{background:white;padding:15px;border-radius:10px;margin-top:15px;}
.hidden{display:none;}
@media print{
body *{visibility:hidden;}
#printArea, #printArea *{visibility:visible;}
#printArea{position:absolute;left:0;top:0;width:100%;}
}
</style>
</head>

<body>
<div class="container py-4">

<div id="loginSection" class="card-box">
<h4 class="text-center">ЁЯФР рж▓ржЧржЗржи</h4>
<input type="password" id="passwordInput" class="form-control mt-3" placeholder="ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб">
<button class="btn btn-primary w-100 mt-3" onclick="login()">рж▓ржЧржЗржи</button>
<p id="loginMsg" class="text-danger mt-2"></p>
</div>

<div id="app" class="hidden">

<div class="header text-center mb-3">
<h4>ржЗржорж░рж╛ржи ржЗрж▓рзЗржХржЯрзНрж░ржирж┐ржХрзНрж╕ ржПржирзНржб ржорзЛржмрж╛ржЗрж▓ рж╕рж╛рж░рзНржнрж┐рж╕рж┐ржВ рж╕рзЗржирзНржЯрж╛рж░</h4>
<p>рж░рж╣рж┐ржо рж╕рж░ржжрж╛рж░ ржорж╛рж░рзНржХрзЗржЯ, ржЧржжржЦрж╛рж▓рзА ржмрж╛ржЬрж╛рж░, ржЭрж┐ржХрж░ржЧрж╛ржЫрж╛, ржпрж╢рзЛрж░</p>
<p>ржорзЛржмрж╛ржЗрж▓: рзжрззрзпрзлрзирзйрзирзлрзпрзжрзй</p>
<button class="btn btn-light btn-sm" onclick="logout()">рж▓ржЧржЖржЙржЯ</button>
</div>

<div class="card-box">
<h5>ЁЯУж ржкржгрзНржп ржпрзЛржЧ ржХрж░рзБржи</h5>
<input id="pName" class="form-control mt-2" placeholder="ржкржгрзНржпрзЗрж░ ржирж╛ржо">
<input id="pBuy" type="number" class="form-control mt-2" placeholder="ржХрзНрж░рзЯржорзВрж▓рзНржп">
<input id="pSell" type="number" class="form-control mt-2" placeholder="ржмрж┐ржХрзНрж░рзЯржорзВрж▓рзНржп">
<input id="pStock" type="number" class="form-control mt-2" placeholder="рж╕рзНржЯржХ">
<button class="btn btn-success w-100 mt-2" onclick="addProduct()">ржпрзЛржЧ ржХрж░рзБржи</button>
</div>

<div class="card-box">
<h5>ЁЯЫТ ржмрж┐ржХрзНрж░рзЯ ржХрж░рзБржи</h5>
<input id="customerName" class="form-control mt-2" placeholder="ржХрж╛рж╕рзНржЯржорж╛рж░рзЗрж░ ржирж╛ржо">
<select id="saleProduct" class="form-control mt-2" onchange="calculateLive()"></select>
<input id="saleQty" type="number" class="form-control mt-2" placeholder="ржкрж░рж┐ржорж╛ржг" oninput="calculateLive()">
<p class="mt-2">ржорзЛржЯ ржмрж┐рж▓: <strong><span id="liveTotal">0</span> рз│</strong></p>
<input id="paidAmount" type="number" class="form-control mt-2" placeholder="ржкрж░рж┐рж╢рзЛржз ржХрж░рзЗржЫрзЗ" oninput="calculateLive()">
<p>ржмрж╛ржХрж┐: <strong><span id="liveDue">0</span> рз│</strong></p>
<button class="btn btn-primary w-100 mt-2" onclick="makeSale()">ржмрж┐ржХрзНрж░рзЯ ржХрж░рзБржи</button>
</div>

<div class="card-box">
<h5>ЁЯУД ржмрж┐ржХрзНрж░рзЯрзЗрж░ рждрж╛рж▓рж┐ржХрж╛</h5>
<table class="table table-bordered">
<thead>
<tr>
<th>Invoice</th><th>ржХрж╛рж╕рзНржЯржорж╛рж░</th><th>ржкржгрзНржп</th><th>ржорзЛржЯ</th><th>ржкрж░рж┐рж╢рзЛржз</th><th>ржмрж╛ржХрж┐</th><th>ржЕрзНржпрж╛ржХрж╢ржи</th>
</tr>
</thead>
<tbody id="saleTable"></tbody>
</table>
</div>

<div class="card-box">
<h5>ЁЯУК рж╕рж╛рж░рж╛ржВрж╢</h5>
<p>ржорзЛржЯ ржмрж┐ржХрзНрж░рзЯ: <span id="totalSale">0</span> рз│</p>
<p>ржорзЛржЯ рж▓рж╛ржн: <span id="totalProfit">0</span> рз│</p>
<p>ржорзЛржЯ ржмрж╛ржХрж┐: <span id="totalDue">0</span> рз│</p>
</div>

<div class="card-box">
<h5>ЁЯУК рж░рж┐ржкрзЛрж░рзНржЯ</h5>
<canvas id="chart"></canvas>
</div>

<button class="btn btn-danger w-100 mt-3" onclick="resetData()">рж╕ржм ржбрж╛ржЯрж╛ ржбрж┐рж▓рж┐ржЯ</button>

</div>
</div>

<div id="printArea" class="hidden p-4"></div>

<script>

let products=JSON.parse(localStorage.getItem("products"))||[];
let sales=JSON.parse(localStorage.getItem("sales"))||[];
let invoiceCounter=+localStorage.getItem("invoiceCounter")||1;
let chartInstance=null;

if(localStorage.getItem("loggedIn")==="true"){
loginSection.classList.add("hidden");
app.classList.remove("hidden");
init();
}

function login(){
let pass=passwordInput.value;
let saved=localStorage.getItem("posPass");
if(!saved){
localStorage.setItem("posPass",pass);
alert("ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рж╕рзЗржЯ рж╣рзЯрзЗржЫрзЗред ржЖржмрж╛рж░ рж▓ржЧржЗржи ржХрж░рзБржи");
return;
}
if(pass===saved){
localStorage.setItem("loggedIn","true");
init();
loginSection.classList.add("hidden");
app.classList.remove("hidden");
}else{
loginMsg.innerText="ржнрзБрж▓ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб";
}
}

function logout(){
localStorage.setItem("loggedIn","false");
location.reload();
}

function init(){
updateProductList();
updateTable();
updateSummary();
updateChart();
}

function addProduct(){
if(!pName.value||!pBuy.value||!pSell.value||!pStock.value){alert("рж╕ржм рждржерзНржп ржжрж┐ржи");return;}
if(products.find(p=>p.name===pName.value)){alert("ржПржЗ ржкржгрзНржп ржЖржЧрзЗржЗ ржЖржЫрзЗ");return;}
products.push({name:pName.value,buy:+pBuy.value,sell:+pSell.value,stock:+pStock.value});
localStorage.setItem("products",JSON.stringify(products));
updateProductList();
alert("ржкржгрзНржп ржпрзЛржЧ рж╣рзЯрзЗржЫрзЗ");
}

function updateProductList(){
saleProduct.innerHTML="";
products.forEach((p,i)=>{
saleProduct.innerHTML+=`<option value="${i}">${p.name} (рж╕рзНржЯржХ:${p.stock})</option>`;
});
}

function calculateLive(){
let i=saleProduct.value;
let qty=+saleQty.value||0;
let paid=+paidAmount.value||0;
if(!products[i])return;
let total=qty*products[i].sell;
if(paid>total)paid=total;
liveTotal.innerText=total;
liveDue.innerText=total-paid;
}

function makeSale(){
let i=saleProduct.value;
let qty=+saleQty.value;
let paid=+paidAmount.value||0;
let customer=customerName.value.trim();

if(!customer){alert("ржХрж╛рж╕рзНржЯржорж╛рж░ ржирж╛ржо ржжрж┐ржи");return;}
if(qty<=0){alert("рж╕ржарж┐ржХ ржкрж░рж┐ржорж╛ржг ржжрж┐ржи");return;}
if(products[i].stock<qty){alert("рж╕рзНржЯржХ ржХржо");return;}

let total=qty*products[i].sell;
if(paid>total)paid=total;
let due=total-paid;
let profit=qty*(products[i].sell-products[i].buy);

products[i].stock-=qty;

let date=new Date().toISOString().split("T")[0];

sales.push({
invoice:invoiceCounter++,
customer,name:products[i].name,
qty,total,paid,due,profit,date
});

localStorage.setItem("invoiceCounter",invoiceCounter);
localStorage.setItem("products",JSON.stringify(products));
localStorage.setItem("sales",JSON.stringify(sales));

init();
clearSaleForm();
}

function clearSaleForm(){
saleQty.value="";
paidAmount.value="";
customerName.value="";
liveTotal.innerText="0";
liveDue.innerText="0";
}

function updateTable(){
saleTable.innerHTML="";
sales.forEach((s,i)=>{
saleTable.innerHTML+=`
<tr>
<td>${s.invoice}</td>
<td>${s.customer}</td>
<td>${s.name}</td>
<td>${s.total}</td>
<td>${s.paid}</td>
<td>${s.due}</td>
<td>
<button class="btn btn-sm btn-info" onclick="printInvoice(${i})">ЁЯЦи</button>
<button class="btn btn-sm btn-danger" onclick="deleteSale(${i})">тЭМ</button>
</td>
</tr>`;
});
}

function deleteSale(i){
products.find(p=>p.name===sales[i].name).stock+=sales[i].qty;
sales.splice(i,1);
localStorage.setItem("sales",JSON.stringify(sales));
localStorage.setItem("products",JSON.stringify(products));
init();
}

function updateSummary(){
let t=0,p=0,d=0;
sales.forEach(s=>{t+=s.total;p+=s.profit;d+=s.due});
totalSale.innerText=t;
totalProfit.innerText=p;
totalDue.innerText=d;
}

function updateChart(){
let dates={};
sales.forEach(s=>{
if(!dates[s.date])dates[s.date]=0;
dates[s.date]+=s.total;
});
if(chartInstance)chartInstance.destroy();
chartInstance=new Chart(chart,{
type:"bar",
data:{labels:Object.keys(dates),
datasets:[{label:"Daily Sales",data:Object.values(dates)}]}
});
}

function printInvoice(i){
let s=sales[i];
printArea.classList.remove("hidden");
printArea.innerHTML=`
<h3>ржЗржорж░рж╛ржи ржЗрж▓рзЗржХржЯрзНрж░ржирж┐ржХрзНрж╕ ржПржирзНржб ржорзЛржмрж╛ржЗрж▓ рж╕рж╛рж░рзНржнрж┐рж╕рж┐ржВ рж╕рзЗржирзНржЯрж╛рж░</h3>
<p>рж░рж╣рж┐ржо рж╕рж░ржжрж╛рж░ ржорж╛рж░рзНржХрзЗржЯ, ржЧржжржЦрж╛рж▓рзА ржмрж╛ржЬрж╛рж░, ржЭрж┐ржХрж░ржЧрж╛ржЫрж╛, ржпрж╢рзЛрж░</p>
<p>ржорзЛржмрж╛ржЗрж▓: рзжрззрзпрзлрзирзйрзирзлрзпрзжрзй</p>
<hr>
<p>Invoice: ${s.invoice}</p>
<p>рждрж╛рж░рж┐ржЦ: ${s.date}</p>
<p>ржХрж╛рж╕рзНржЯржорж╛рж░: ${s.customer}</p>
<p>ржкржгрзНржп: ${s.name}</p>
<p>ржкрж░рж┐ржорж╛ржг: ${s.qty}</p>
<p>ржорзЛржЯ: ${s.total} рз│</p>
<p>ржкрж░рж┐рж╢рзЛржз: ${s.paid} рз│</p>
<p>ржмрж╛ржХрж┐: ${s.due} рз│</p>
<hr>
<p>ржзржирзНржпржмрж╛ржж</p>
`;
window.print();
printArea.classList.add("hidden");
}

function resetData(){
if(confirm("рж╕ржм ржбрж╛ржЯрж╛ ржбрж┐рж▓рж┐ржЯ ржХрж░ржмрзЗржи?")){
localStorage.removeItem("products");
localStorage.removeItem("sales");
localStorage.removeItem("invoiceCounter");
location.reload();
}
}

</script>
</body>
</html>
