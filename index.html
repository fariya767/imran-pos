<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Imran Electronics POS</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{background:#f4f6f9;}
.header{background:#0d6efd;color:white;padding:15px;border-radius:10px;}
.card-box{background:white;padding:15px;border-radius:10px;margin-top:15px;}
.summary{color:white;padding:15px;border-radius:10px;text-align:center;}
.s1{background:#198754;}
.s2{background:#6f42c1;}
.s3{background:#dc3545;}
.s4{background:#fd7e14;}
.s5{background:#0dcaf0;}
.hidden{display:none;}
@media print{
body *{visibility:hidden;}
#invoiceSection,#invoiceSection *{visibility:visible;}
#invoiceSection{position:absolute;left:0;top:0;width:100%;}
}
</style>
</head>

<body>
<div class="container py-4">

<!-- LOGIN -->
<div id="loginSection" class="card-box shadow-sm">
<h4 class="text-center">üîê POS ‡¶≤‡¶ó‡¶á‡¶®</h4>
<input type="password" id="passwordInput" class="form-control mt-3" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°">
<button class="btn btn-primary w-100 mt-3" onclick="login()">‡¶≤‡¶ó‡¶á‡¶®</button>
<p id="loginMessage" class="text-center mt-2"></p>
</div>

<!-- MAIN APP -->
<div id="mainApp" class="hidden">

<div class="header text-center mb-3">
<h4>‡¶á‡¶Æ‡¶∞‡¶æ‡¶® ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶®‡¶ø‡¶ï‡ßç‡¶∏ ‡¶è‡¶®‡ßç‡¶° ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏‡¶ø‡¶Ç ‡¶∏‡ßá‡¶®‡ßç‡¶ü‡¶æ‡¶∞</h4>
<p>‡¶∞‡¶π‡¶ø‡¶Æ ‡¶∏‡¶∞‡¶¶‡¶æ‡¶∞ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶ü, ‡¶ó‡¶¶‡¶ñ‡¶æ‡¶≤‡ßÄ ‡¶¨‡¶æ‡¶ú‡¶æ‡¶∞, ‡¶ù‡¶ø‡¶ï‡¶∞‡¶ó‡¶æ‡¶õ‡¶æ, ‡¶Ø‡¶∂‡ßã‡¶∞<br>
‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤: ‡ß¶‡ßß‡ßØ‡ß´‡ß®‡ß©‡ß®‡ß´‡ßØ‡ß¶‡ß©</p>
<button class="btn btn-light btn-sm float-end" onclick="logout()">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
</div>

<!-- SUMMARY -->
<div class="row">
<div class="col-md-4 col-6"><div class="summary s1">‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü<br><span id="totalSale">0</span> ‡ß≥</div></div>
<div class="col-md-4 col-6"><div class="summary s2">‡¶Æ‡ßã‡¶ü ‡¶≤‡¶æ‡¶≠<br><span id="totalProfit">0</span> ‡ß≥</div></div>
<div class="col-md-4 col-6"><div class="summary s3">‡¶Æ‡ßã‡¶ü ‡¶¨‡¶æ‡¶ï‡¶ø<br><span id="totalDue">0</span> ‡ß≥</div></div>
<div class="col-md-4 col-6 mt-2"><div class="summary s4">‡¶Æ‡ßã‡¶ü ‡¶™‡¶£‡ßç‡¶Ø<br><span id="totalProducts">0</span></div></div>
<div class="col-md-4 col-6 mt-2"><div class="summary s5">‡¶∏‡ßç‡¶ü‡¶ï ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡ßÅ<br><span id="stockValue">0</span> ‡ß≥</div></div>
</div>

<!-- PRODUCT ADD -->
<div class="card-box">
<h5>‚ûï ‡¶™‡¶£‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h5>
<input id="pName" class="form-control mt-2" placeholder="‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ">
<input id="pPrice" type="number" class="form-control mt-2" placeholder="‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø">
<input id="pCost" type="number" class="form-control mt-2" placeholder="‡¶ï‡ßç‡¶∞‡ßü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø">
<input id="pStock" type="number" class="form-control mt-2" placeholder="‡¶∏‡ßç‡¶ü‡¶ï">
<button class="btn btn-success mt-2" onclick="addProduct()">Add Product</button>
</div>

<!-- SALES -->
<div class="card-box">
<h5>üõí ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü</h5>

<select id="productSelect" class="form-control mt-2"></select>
<input id="qty" type="number" class="form-control mt-2" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£">
<button class="btn btn-primary mt-2" onclick="addToCart()">Add To Cart</button>

<table class="table mt-3">
<thead><tr><th>‡¶™‡¶£‡ßç‡¶Ø</th><th>Qty</th><th>‡¶¶‡¶æ‡¶Æ</th><th>‡¶Æ‡ßã‡¶ü</th><th></th></tr></thead>
<tbody id="cartTable"></tbody>
</table>

‡¶Æ‡ßã‡¶ü: <span id="subtotal">0</span> ‡ß≥ <br>
Paid: <input type="number" id="paid" oninput="calculateDue()"><br>
Due: <span id="due">0</span> ‡ß≥ <br>

<button class="btn btn-success mt-2" onclick="finalizeSale()">Final Sale</button>
<button class="btn btn-secondary mt-2" onclick="printInvoice()">Print</button>
</div>

<!-- REPORT -->
<div class="card-box">
<h5>üìä ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</h5>
<canvas id="salesChart"></canvas>
</div>

<div id="invoiceSection" class="hidden"></div>

</div>
</div>

<script>
let products=JSON.parse(localStorage.getItem("products"))||[];
let sales=JSON.parse(localStorage.getItem("sales"))||[];
let cart=[];
let invoiceCounter=localStorage.getItem("invoiceCounter")||1;
let chartInstance=null;

function login(){
let input=passwordInput.value;
let saved=localStorage.getItem("posPassword");
if(!saved){
localStorage.setItem("posPassword",input);
loginMessage.innerText="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá";
return;
}
if(input===saved){
localStorage.setItem("isLoggedIn","true");
showApp();
}else loginMessage.innerText="‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°";
}

function logout(){
localStorage.removeItem("isLoggedIn");
location.reload();
}

function showApp(){
loginSection.classList.add("hidden");
mainApp.classList.remove("hidden");
loadProducts();
updateDashboard();
updateChart();
}

window.onload=function(){
if(localStorage.getItem("isLoggedIn")==="true") showApp();
};

function addProduct(){
let name=pName.value;
let price=parseFloat(pPrice.value);
let cost=parseFloat(pCost.value);
let stock=parseInt(pStock.value);
if(!name||price<=0||cost<0||stock<0)return alert("‡¶∏‡¶†‡¶ø‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®");
products.push({name,price,cost,stock});
localStorage.setItem("products",JSON.stringify(products));
loadProducts();
updateDashboard();
}

function loadProducts(){
productSelect.innerHTML="";
products.forEach(p=>{
productSelect.innerHTML+=`<option value="${p.name}">${p.name} (‡¶∏‡ßç‡¶ü‡¶ï:${p.stock})</option>`;
});
}

function addToCart(){
let name=productSelect.value;
let qty=parseInt(document.getElementById("qty").value);
let product=products.find(p=>p.name===name);
if(!name||qty<=0||product.stock<qty)return alert("‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶Ü‡¶õ‡ßá");
let existing=cart.find(c=>c.name===name);
if(existing)existing.qty+=qty;
else cart.push({name,price:product.price,cost:product.cost,qty});
updateCart();
}

function updateCart(){
cartTable.innerHTML="";
let total=0;
cart.forEach((item,i)=>{
let t=item.price*item.qty;
total+=t;
cartTable.innerHTML+=`<tr>
<td>${item.name}</td><td>${item.qty}</td>
<td>${item.price}</td><td>${t}</td>
<td><button onclick="removeItem(${i})" class="btn btn-danger btn-sm">X</button></td></tr>`;
});
subtotal.innerText=total;
calculateDue();
}

function removeItem(i){cart.splice(i,1);updateCart();}

function calculateDue(){
let total=parseFloat(subtotal.innerText)||0;
let paid=parseFloat(document.getElementById("paid").value)||0;
if(paid>total){alert("Paid ‡¶¨‡ßá‡¶∂‡¶ø");document.getElementById("paid").value=total;paid=total;}
due.innerText=total-paid;
}

function finalizeSale(){
if(cart.length==0)return alert("‡¶ï‡¶æ‡¶∞‡ßç‡¶ü ‡¶ñ‡¶æ‡¶≤‡¶ø");
let total=parseFloat(subtotal.innerText);
let paid=parseFloat(document.getElementById("paid").value)||0;
let dueAmount=total-paid;
let profit=0;
cart.forEach(item=>{
let p=products.find(pr=>pr.name===item.name);
p.stock-=item.qty;
profit+=(item.price-item.cost)*item.qty;
});
let invoice="INV-"+invoiceCounter.toString().padStart(4,"0");
sales.push({invoice,items:cart,total,paid,due:dueAmount,profit,date:new Date().toISOString().split("T")[0]});
localStorage.setItem("sales",JSON.stringify(sales));
localStorage.setItem("products",JSON.stringify(products));
invoiceCounter++;localStorage.setItem("invoiceCounter",invoiceCounter);
cart=[];updateCart();loadProducts();updateDashboard();updateChart();
alert("‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®");
}

function updateDashboard(){
let totalSale=0,totalProfit=0,totalDue=0,stockValue=0;
sales.forEach(s=>{totalSale+=s.total;totalProfit+=s.profit;totalDue+=s.due;});
products.forEach(p=>{stockValue+=p.cost*p.stock;});
document.getElementById("totalSale").innerText=totalSale;
document.getElementById("totalProfit").innerText=totalProfit;
document.getElementById("totalDue").innerText=totalDue;
document.getElementById("totalProducts").innerText=products.length;
document.getElementById("stockValue").innerText=stockValue;
}

function updateChart(){
let dates={};
sales.forEach(s=>{if(!dates[s.date])dates[s.date]=0;dates[s.date]+=s.total;});
if(chartInstance)chartInstance.destroy();
chartInstance=new Chart(document.getElementById("salesChart"),{
type:"bar",
data:{labels:Object.keys(dates),
datasets:[{label:"Daily Sales ‡ß≥",data:Object.values(dates)}]}
});
}

function printInvoice(){window.print();}
</script>
</body>
</html>
